<div class="bg-white min-h-screen pb-20 font-sans">
    <div class="container mx-auto px-6 py-12">
        <!-- Breadcrumbs -->
        <nav class="flex items-center text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 mb-12"
            *ngIf="product">
            <a routerLink="/" class="hover:text-slate-900 transition-colors">Shop</a>
            <span class="mx-3 text-slate-200">/</span>
            <span class="hover:text-slate-900 transition-colors cursor-pointer">{{ getCategoryName(product.category)
                }}</span>
            <span class="mx-3 text-slate-200">/</span>
            <span class="text-slate-900">{{ product.name }}</span>
        </nav>

        <div *ngIf="loading" class="flex justify-center items-center py-32">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-slate-900"></div>
        </div>

        <div *ngIf="!loading && product" class="grid grid-cols-1 lg:grid-cols-2 gap-16 xl:gap-24 mb-32 items-start">

            <!-- Left: Hero Image (Sticky) -->
            <div class="lg:sticky lg:top-12">
                <div
                    class="bg-slate-50 rounded-[40px] aspect-[4/3] lg:aspect-square flex items-center justify-center p-12 lg:p-20 relative overflow-hidden">
                    <img *ngIf="product.imageUrl" [src]="product.imageUrl" [alt]="product.name"
                        class="max-w-full max-h-full object-contain filter drop-shadow-2xl transition-transform duration-700 hover:scale-105">
                    <span *ngIf="!product.imageUrl" class="text-6xl grayscale opacity-10">ðŸ“¦</span>
                </div>
            </div>

            <!-- Right: Details -->
            <div class="flex flex-col pt-4">
                <span
                    class="inline-block px-3 py-1 rounded-full bg-blue-50 text-blue-600 text-[9px] font-black uppercase tracking-[0.2em] w-fit mb-6">
                    {{ getCategoryName(product.category) }}
                </span>

                <h1
                    class="text-4xl md:text-5xl lg:text-6xl font-black text-slate-900 leading-[0.95] tracking-tighter mb-8">
                    {{ product.name }}
                </h1>

                <!-- Price Section -->
                <div class="bg-slate-50 rounded-[32px] p-8 md:p-10 border border-slate-100 mb-10">
                    <div class="flex items-baseline gap-4 mb-2">
                        <span class="text-4xl sm:text-5xl font-black text-slate-900 tracking-tighter">
                            {{ product.price | currency }}
                        </span>
                        <span *ngIf="product.previousPrice && product.price < product.previousPrice"
                            class="bg-rose-100 text-rose-600 px-2 py-1 rounded-md text-[10px] font-black uppercase tracking-wider">
                            {{ ((product.previousPrice - product.price) / product.previousPrice * 100).toFixed(0) }}%
                            Off
                        </span>
                    </div>

                    <div class="flex items-center gap-3 mb-6">
                        <span *ngIf="product.previousPrice"
                            class="text-slate-400 font-bold line-through decoration-slate-300 text-sm">
                            {{ product.previousPrice | currency }}
                        </span>
                        <span class="text-emerald-600 text-[9px] font-black uppercase tracking-widest">Market Value
                            Adjustment</span>
                    </div>

                    <div
                        class="inline-flex bg-slate-900 text-white px-5 py-2 rounded-full text-[9px] font-black uppercase tracking-widest shadow-xl shadow-slate-900/10 mb-0">
                        <span class="mr-2 opacity-50">#</span> Winter Offer
                    </div>
                </div>

                <!-- Badges -->
                <div class="flex flex-wrap gap-3 mb-12">
                    <div
                        class="pl-2 pr-4 py-2 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-100 flex items-center gap-3">
                        <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse ml-2"></div>
                        <span class="text-[9px] font-black uppercase tracking-widest">Priority Stock Dispatch</span>
                    </div>
                    <div
                        class="pl-2 pr-4 py-2 rounded-full bg-white text-slate-500 border border-slate-200 flex items-center gap-3">
                        <div class="w-4 h-4 rounded-full bg-slate-100 flex items-center justify-center ml-1">
                            <svg class="w-2.5 h-2.5 text-slate-400" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <span class="text-[9px] font-black uppercase tracking-widest">Global Shipping Tier</span>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex flex-col gap-4 mb-8">
                    <div class="grid grid-cols-12 gap-4 h-16">
                        <!-- Quantity -->
                        <div
                            class="col-span-4 bg-slate-50 border border-slate-200 rounded-2xl flex items-center justify-between px-2">
                            <button (click)="decrementQuantity()"
                                class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-slate-900 font-bold transition active:scale-90 text-xl">âˆ’</button>
                            <span class="font-black text-slate-900">{{ quantity }}</span>
                            <button (click)="incrementQuantity()"
                                class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-slate-900 font-bold transition active:scale-90 text-xl">+</button>
                        </div>

                        <!-- Add to Cart -->
                        <button (click)="addToCart($event)" [disabled]="!product.stock"
                            class="col-span-8 bg-slate-950 text-white rounded-2xl font-black text-[10px] uppercase tracking-[0.25em] hover:bg-black hover:shadow-2xl transition-all active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed">
                            Add to Cart
                        </button>
                    </div>

                    <!-- One Click -->
                    <button (click)="buyNow($event)" [disabled]="!product.stock"
                        class="w-full h-16 bg-blue-600 text-white rounded-2xl font-black text-[10px] uppercase tracking-[0.25em] hover:bg-blue-700 hover:shadow-blue-500/25 hover:shadow-2xl transition-all active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed">
                        Secure One-Click Order
                    </button>
                </div>

                <!-- Product Intelligence (Specs) -->
                <div class="mb-6">
                    <h3 class="text-[9px] font-bold text-slate-400 uppercase tracking-widest mb-4">Product Intelligence
                    </h3>
                    <div class="space-y-2">
                        <div *ngFor="let spec of getSpecificationsArray()"
                            class="flex justify-between items-center py-2 border-b border-slate-50 last:border-0">
                            <span class="text-[9px] font-medium text-slate-500 uppercase tracking-wide">{{ spec.key
                                }}</span>
                            <span class="text-[10px] font-bold text-slate-900">{{ spec.value }}</span>
                        </div>
                    </div>
                </div>

                <!-- Price History Toggle -->
                <!-- Price History Toggle -->
                <!-- Price History Toggle -->
                <button (click)="togglePriceHistory()"
                    class="group flex items-center justify-between w-full p-4 bg-slate-50 rounded-xl border border-slate-100 hover:border-slate-200 transition-all mb-4 cursor-pointer relative z-10 active:scale-[0.98]">
                    <span
                        class="text-[9px] font-bold uppercase tracking-widest text-slate-500 group-hover:text-slate-900 transition-colors">Real-Time
                        Market Index</span>
                    <div
                        class="w-6 h-6 rounded-full bg-white border border-slate-200 flex items-center justify-center group-hover:scale-110 transition-transform">
                        <svg class="w-3 h-3 text-slate-400 group-hover:text-slate-900 transition-colors duration-300"
                            [class.rotate-180]="viewGraph" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </button>

                <!-- Compact Inline Graph (Conditional) -->
                <div *ngIf="viewGraph"
                    class="bg-white border border-slate-100 rounded-2xl p-6 shadow-xl shadow-slate-900/5 animate-fade-in-up origin-top">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h4 class="text-sm font-black text-slate-900 uppercase tracking-wide">30-Day Trend</h4>
                            <p class="text-[9px] font-bold text-slate-400 mt-1">Real-time market valuation</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="flex items-center gap-1.5"><span
                                    class="w-1.5 h-1.5 rounded-full bg-blue-500"></span><span
                                    class="text-[8px] font-black uppercase tracking-widest text-slate-400">Price</span>
                            </div>
                        </div>
                    </div>

                    <div class="relative w-full h-40">
                        <svg viewBox="0 0 600 250" class="w-full h-full overflow-visible">
                            <!-- Simple Grid -->
                            <line x1="0" y1="250" x2="600" y2="250" stroke="#f1f5f9" stroke-width="1" />

                            <!-- Gradient Defs -->
                            <defs>
                                <linearGradient id="lineGradient" x1="0" x2="0" y1="0" y2="1">
                                    <stop offset="0%" stop-color="#3b82f6" stop-opacity="0.1" />
                                    <stop offset="100%" stop-color="#3b82f6" stop-opacity="0" />
                                </linearGradient>
                            </defs>

                            <!-- Area Fill -->
                            <!-- (Optional: could add area path here if calculated) -->

                            <!-- Path -->
                            <path [attr.d]="chartPath" fill="none" stroke="#2563eb" stroke-width="3"
                                stroke-linecap="round" stroke-linejoin="round" class="drop-shadow-sm" />

                            <!-- Points -->
                            <g *ngFor="let p of chartPoints" class="group/point cursor-crosshair">
                                <circle [attr.cx]="p.x" [attr.cy]="p.y" r="4"
                                    class="fill-white stroke-blue-600 stroke-[3] transition-all hover:r-6" />

                                <!-- Compact Tooltip -->
                                <g
                                    class="opacity-0 group-hover/point:opacity-100 transition-all pointer-events-none -translate-y-2">
                                    <rect [attr.x]="p.x - 30" [attr.y]="p.y - 45" width="60" height="30" rx="8"
                                        fill="#1e293b" />
                                    <text [attr.x]="p.x" [attr.y]="p.y - 26" text-anchor="middle" fill="white"
                                        font-size="10" font-weight="bold">{{ p.price | currency:'USD':'symbol':'1.0-0'
                                        }}</text>
                                    <path
                                        [attr.d]="'M' + p.x + ',' + (p.y - 15) + ' L' + (p.x - 4) + ',' + (p.y - 20) + ' L' + (p.x + 4) + ',' + (p.y - 20) + ' Z'"
                                        fill="#1e293b" />
                                </g>
                            </g>
                        </svg>
                    </div>
                </div>
            </div>
        </div>



        <!-- Similar Products -->
        <div *ngIf="similarProducts.length > 0" class="border-t border-slate-100 pt-32">
            <div class="flex items-end justify-between mb-16">
                <div>
                    <span
                        class="text-[9px] font-black uppercase tracking-[0.3em] text-blue-600 mb-4 block">Discovery</span>
                    <h2 class="text-4xl font-black text-slate-900 tracking-tighter">You May Also Like</h2>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div *ngFor="let p of similarProducts" [routerLink]="['/shop', p.id]"
                    class="group bg-white rounded-[32px] p-4 border border-slate-100 hover:border-slate-200 transition-all hover:shadow-2xl hover:shadow-slate-900/5 cursor-pointer">
                    <div
                        class="bg-slate-50 rounded-3xl aspect-square flex items-center justify-center p-8 mb-6 relative overflow-hidden group-hover:bg-slate-100/50 transition-colors">
                        <img *ngIf="p.imageUrl" [src]="p.imageUrl"
                            class="max-w-full max-h-full object-contain mix-blend-multiply group-hover:scale-110 transition-transform duration-700">
                        <span *ngIf="!p.imageUrl" class="text-3xl opacity-10">ðŸ“¦</span>
                        <div *ngIf="(p.stock || 0) > 0"
                            class="absolute top-4 right-4 w-2 h-2 rounded-full bg-emerald-500">
                        </div>
                    </div>
                    <div class="px-2 pb-2">
                        <h3 class="font-bold text-slate-900 mb-2 truncate">{{ p.name }}</h3>
                        <div class="flex justify-between items-center">
                            <span class="text-lg font-black text-slate-900 tracking-tight">{{ p.price | currency
                                }}</span>
                            <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest">{{
                                getCategoryName(p.category) }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>